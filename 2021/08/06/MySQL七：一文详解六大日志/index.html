<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>MySQL(七)：一文详解六大日志 - 云扬四海</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="云扬四海"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="云扬四海"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="日志一般分为逻辑日志与物理日志两类  「逻辑日志」：即执行过的事务中的sql语句，执行的sql语句（增删改）「反向」的信息 「物理日志」：mysql 数据最终是保存在数据页中的，物理日志记录的就是数据页变更 。  「mysql数据库中日志是重要组成部分，记录着数据库运行期间各种状态信息」。主要有6类：  二进制日志 重做日志 撤销日志 错误日志 查询日志 中继日志"><meta property="og:type" content="blog"><meta property="og:title" content="MySQL(七)：一文详解六大日志"><meta property="og:url" content="http://ityouknow.cn/2021/08/06/MySQL%E4%B8%83%EF%BC%9A%E4%B8%80%E6%96%87%E8%AF%A6%E8%A7%A3%E5%85%AD%E5%A4%A7%E6%97%A5%E5%BF%97/"><meta property="og:site_name" content="云扬四海"><meta property="og:description" content="日志一般分为逻辑日志与物理日志两类  「逻辑日志」：即执行过的事务中的sql语句，执行的sql语句（增删改）「反向」的信息 「物理日志」：mysql 数据最终是保存在数据页中的，物理日志记录的就是数据页变更 。  「mysql数据库中日志是重要组成部分，记录着数据库运行期间各种状态信息」。主要有6类：  二进制日志 重做日志 撤销日志 错误日志 查询日志 中继日志"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124907.png"><meta property="og:image" content="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124947.png"><meta property="og:image" content="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124978.png"><meta property="og:image" content="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124896.png"><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124974.png"><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124908.png"><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124055.png"><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124161.png"><meta property="og:image" content="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124222.png"><meta property="article:published_time" content="2021-08-06T08:07:00.000Z"><meta property="article:modified_time" content="2022-08-06T09:34:16.299Z"><meta property="article:author" content="yunlongn"><meta property="article:tag" content="Mysql"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://ityouknow.cn/2021/08/06/MySQL%E4%B8%83%EF%BC%9A%E4%B8%80%E6%96%87%E8%AF%A6%E8%A7%A3%E5%85%AD%E5%A4%A7%E6%97%A5%E5%BF%97/"},"headline":"云扬四海","image":["https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124907.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124947.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124978.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124896.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124974.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124908.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124055.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124161.png","https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124222.png"],"datePublished":"2021-08-06T08:07:00.000Z","dateModified":"2022-08-06T09:34:16.299Z","author":{"@type":"Person","name":"yunlongn"},"description":"日志一般分为逻辑日志与物理日志两类  「逻辑日志」：即执行过的事务中的sql语句，执行的sql语句（增删改）「反向」的信息 「物理日志」：mysql 数据最终是保存在数据页中的，物理日志记录的就是数据页变更 。  「mysql数据库中日志是重要组成部分，记录着数据库运行期间各种状态信息」。主要有6类：  二进制日志 重做日志 撤销日志 错误日志 查询日志 中继日志"}</script><link rel="canonical" href="http://ityouknow.cn/2021/08/06/MySQL%E4%B8%83%EF%BC%9A%E4%B8%80%E6%96%87%E8%AF%A6%E8%A7%A3%E5%85%AD%E5%A4%A7%E6%97%A5%E5%BF%97/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.8.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">云扬四海</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">列表</a><a class="navbar-item" href="/categories">类别</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="/yun/fireworks.html">fireworks</a><a class="navbar-item" href="/yun/sheep.html">sheep</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="http://github.com/yunlongn"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-08-06T08:07:00.000Z" title="2021-08-06T08:07:00.000Z">2021-08-06</time>发表</span><span class="level-item"><time dateTime="2022-08-06T09:34:16.299Z" title="2022-08-06T09:34:16.299Z">2022-08-06</time>更新</span><span class="level-item"> yunlongn </span><span class="level-item"><a class="link-muted" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span> / </span><a class="link-muted" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql/">Mysql</a></span><span class="level-item">1 小时读完 (大约7245个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">MySQL(七)：一文详解六大日志</h1><div class="content"><p>日志一般分为逻辑日志与物理日志两类</p>
<ul>
<li><strong>「逻辑日志」</strong>：即执行过的事务中的sql语句，执行的sql语句（增删改）<strong>「反向」</strong>的信息</li>
<li><strong>「物理日志」</strong>：<code>mysql</code> 数据最终是保存在数据页中的，物理日志记录的就是数据页变更 。</li>
</ul>
<p><strong>「<code>mysql</code>数据库中日志是重要组成部分，记录着数据库运行期间各种状态信息」</strong>。主要有6类：</p>
<ul>
<li>二进制日志</li>
<li>重做日志</li>
<li>撤销日志</li>
<li>错误日志</li>
<li>查询日志</li>
<li>中继日志<a id="more"></a></li>
</ul>
<p><strong>「而我们一般比较关注的是二进制日志( <code>binlog</code> )和事务日志(包括重做日志<code>redo log</code> 和撤销日志 <code>undo log</code> )」</strong>。</p>
<h2 id="一、二进制日志-binlog"><a href="#一、二进制日志-binlog" class="headerlink" title="一、二进制日志(binlog)"></a><strong>一、二进制日志(binlog)</strong></h2><h3 id="1-1-什么是binlog"><a href="#1-1-什么是binlog" class="headerlink" title="1.1 什么是binlog"></a>1.1 什么是binlog</h3><p><strong>「记录对MySQL数据库执行的更改操作，包括语句的发生时间、执行时长，主要用于数据库恢复和主从复制」</strong>。但不记录select、show等不修改数据库的SQL。</p>
<p><strong>「<code>binlog</code>是逻辑日志，在 <code>mysql Server</code> 层进行记录，属于<code>mysql</code>全局日志，无论使用什么存储引擎都会记录 <code>binlog</code> 日志」</strong>。</p>
<ul>
<li><p><strong>「binlog产生的时机」</strong></p>
<p><strong>「事务提交的时候，一次性将事务中的sql语句（一个事物可能对应多个sql语句）按照一定的格式记录到binlog中」</strong>。</p>
</li>
<li><p><strong>「binlog记录方式」</strong></p>
<p><strong>「<code>binlog</code> 是通过追加的方式记录数据库执行的写操作(不包括读操作)信息，以二进制保存在磁盘中。」</strong></p>
</li>
<li><p><strong>「开启binlog」</strong></p>
<p>在my.inf主配置文件中添加如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#打开binlog日志 默认是OFF</span><br><span class="line">log_bin&#x3D;ON</span><br><span class="line">#binlog日志的基本文件名，后面会追加标识来表示每一个文件 例如：mysql-bin.000094</span><br><span class="line">log_bin_basename&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line">#指定的是binlog文件的索引文件  管理所有的binlog文件的目录 记录有多少个binlog文件等</span><br><span class="line">log_bin_index&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin.index</span><br><span class="line"></span><br><span class="line">#或者将以上三个配置合二为一</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-bin</span><br><span class="line">#mysql会根据这个配置自动设置log_bin为on状态，自动设置log_bin_index文件为指定文件名后跟.index</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
</li>
<li><p><strong>「binlog大小设置与过期时间」</strong></p>
<p><strong>「<code>binlog</code> 是通过追加的方式进行写入的，有两个参数需要控制binlog大小设置与过期时间」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">expire_logs_days &#x3D; 7</span><br><span class="line">max_binlog_size &#x3D; 104857600</span><br><span class="line"></span><br><span class="line">set global max_binlog_size&#x3D;104857600;#100M</span><br><span class="line">show variables like &#39;%max_binlog_size%&#39;;</span><br><span class="line">show variables like &#39;%expire_logs_days%&#39;;</span><br><span class="line">expire_logs_days </span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set global max_binlog_size&#x3D;104857600;#100M</span><br><span class="line">set global expire_logs_days &#x3D; 7;</span><br><span class="line">show variables like &#39;%max_binlog_size%&#39;;</span><br><span class="line">show variables like &#39;%expire_logs_days%&#39;;</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li><p><strong>「查看配置」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%max_binlog_size%&#39;;</span><br><span class="line">show variables like &#39;%expire_logs_days%&#39;;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>「命令配置」</strong></p>
<p>及时生效，重启失效，</p>
</li>
<li><p><strong>「max_binlog_size」</strong></p>
<p><strong>「<code>max_binlog_size</code> 代表每个 <code>binlog</code>文件的大小，当文件大小达到给定值之后，会生成新的文件来保存日志，默认值是1GB」</strong>。</p>
</li>
<li><p><strong>「expire_logs_days」</strong></p>
<p><strong>「mysql自动清除过期binlog日志的天数。默认值为0,表示没有自动删除」</strong>。</p>
</li>
<li><p><strong>「配置文件配置」</strong></p>
<p>永久性，需要重启，修改my.conf：</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124907.png" alt="图片"></p>
<h3 id="1-2-binlog使用场景"><a href="#1-2-binlog使用场景" class="headerlink" title="1.2 binlog使用场景"></a>1.2 binlog使用场景</h3><p>在实际应用中， <code>binlog</code> 的主要使用场景有两个，分别是 <strong>「主从复制」</strong> 和 <strong>「数据恢复」</strong> 。</p>
<ol>
<li><p><strong>「数据复制」</strong> ：</p>
<p>在 <code>Master</code> 端开启 <code>binlog</code> ，然后将 <code>binlog</code>发送到各个 <code>Slave</code> 端， <code>Slave</code> 端执行 <code>binlog</code> 从而达到主从数据一致。</p>
</li>
<li><p><strong>「数据恢复」</strong></p>
<p>通过使用 <code>mysqlbinlog</code> 工具来恢复数据。</p>
</li>
</ol>
<h3 id="1-3-binlog刷盘时机"><a href="#1-3-binlog刷盘时机" class="headerlink" title="1.3 binlog刷盘时机"></a>1.3 binlog刷盘时机</h3><p><strong>「对于 <code>InnoDB</code> 存储引擎而言，只有在事务提交时才会记录<code>biglog</code> 日志」</strong>，此时记录还在内存中，那么 <code>biglog</code>是什么时候刷到磁盘中的呢？</p>
<p><strong>「<code>mysql</code> 通过 <code>sync_binlog</code> 参数控制 <code>biglog</code> 的刷盘时机，取值范围是 <code>0-N</code>：」</strong></p>
<ul>
<li>0：不去强制要求，由系统自行判断何时写入磁盘；</li>
<li>1：每次 <code>commit</code> 的时候都要将 <code>binlog</code> 写入磁盘；</li>
<li>N：每N个事务，才会将 <code>binlog</code> 写入磁盘。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%sync_binlog%&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p><strong>「<code>MySQL 5.7.7</code>之后版本的 <code>sync_binlog</code> 默认值是 <code>1</code> ，配置为1也是数据最不容易丢失的，但是设置一个大一些的值可以提升数据库性能，因此实际情况下也可以将值适当调大，牺牲一定的一致性来获取更好的性能。」</strong></p>
<h3 id="1-4-binlog日志格式"><a href="#1-4-binlog日志格式" class="headerlink" title="1.4 binlog日志格式"></a>1.4 binlog日志格式</h3><p><code>binlog</code> 日志格式通过 <code>binlog_format</code> 指定，有三种格式，分别为 <code>STATMENT</code> 、 <code>ROW</code> 和 <code>MIXED</code>。日志。</p>
<blockquote>
<p>在 <code>MySQL 5.7.7</code> 之前，默认的格式是 <code>STATEMENT</code> ， <code>MySQL 5.7.7</code> 之后，默认值是 <code>ROW</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%binlog_format%&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>「STATMENT」</strong></p>
<p>基于<code>SQL</code> 语句的复制( <code>statement-based replication, SBR</code> )，每一条修改数据的sql语句会记录到<code>binlog</code> 中  。</p>
</li>
<li><ul>
<li>缺点：在某些情况下会导致主从数据不一致，比如执行sysdate() 、  slepp()  等 。</li>
<li>优点：不需要记录每一行数据的变化，减少了 binlog 日志量，节约 IO  , 从而提高了性能；</li>
</ul>
</li>
<li><p><strong>「ROW」</strong></p>
<p>基于行的复制(<code>row-based replication, RBR</code> )，不记录每条sql语句的上下文信息，仅需记录哪条数据被修改了 。</p>
</li>
<li><ul>
<li>缺点：会产生大量的日志，尤其是<code>alter table</code> 的时候会让日志暴涨</li>
<li>优点：能清楚记录每一个行数据的修改细节，能完全实现主从数据同步和数据的恢复；</li>
</ul>
</li>
<li><p><strong>「MIXED」</strong></p>
<p>基于<code>STATMENT</code> 和 <code>ROW</code> 两种模式的混合复制(<code>mixed-based replication, MBR</code> )，一般的复制使用<code>STATEMENT</code> 模式保存 <code>binlog</code> ，对于 <code>STATEMENT</code> 模式无法复制的操作使用 <code>ROW</code> 模式保存 <code>binlog</code></p>
</li>
</ul>
<h2 id="二、重做日志（Redo-Log）"><a href="#二、重做日志（Redo-Log）" class="headerlink" title="二、重做日志（Redo Log）"></a><strong>二、重做日志（Redo Log）</strong></h2><p><strong>「重做日志（Redo Log）是InnoDB存储引擎所特有的日志」</strong>。了解Redo Log从以下几个方向来看：</p>
<ul>
<li>Redo Log解决了什么问题</li>
<li>为什么需要redo log</li>
<li>redo log效率为什么快</li>
<li>redo log file刷盘</li>
<li>Redo Log和BinLog的比较</li>
</ul>
<h3 id="2-1Redo-Log解决了什么问题"><a href="#2-1Redo-Log解决了什么问题" class="headerlink" title="2.1Redo Log解决了什么问题"></a>2.1Redo Log解决了什么问题</h3><p><strong>「InnoDB作为MySQL的存储引擎，数据是存放在磁盘中的，如果每次读写数据都需要磁盘I/O，效率会很低。」</strong></p>
<p>为提高读写效率，InnoDB添加了缓存池（Buffer Pool）作为访问数据库的缓冲，其包含了磁盘中部分数据页的映射。</p>
<ul>
<li><strong>「当从数据库读取数据时，会首先从Buffer Pool中读取，如果Buffer Pool中没有，则需要从磁盘中读取然后放入 Buffer Pool；」</strong></li>
<li><strong>「当向数据库写入数据时，会首先写入Buffer Pool，Buffer Pool中修改的数据会定期刷新到磁盘中（即：刷脏）」</strong>。</li>
</ul>
<p><em>Buffer Pool的使用大大提高了读写数据的效率，但是也带了新的问题：如果MySQL宕机，而此时Buffer Pool中修改的数据还没有刷新到磁盘，就会导致数据的丢失，事务的持久性无法保证</em>。而Redo Log 解决了这个问题。</p>
<h3 id="2-1为什么需要redo-log"><a href="#2-1为什么需要redo-log" class="headerlink" title="2.1为什么需要redo log"></a>2.1为什么需要redo log</h3><ul>
<li><p>事务的四大特性ACID中有一个是 <strong>「持久性」</strong></p>
<p><strong>「只要事务提交成功，那么对数据库做的修改就被永久保存下来了，不可能因为任何原因再回到原来的状态」</strong> 。</p>
</li>
<li><p><strong>「<code>mysql</code>是如何保证一致性」</strong></p>
</li>
</ul>
<p>最简单的做法是在每次事务提交的时候，将该事务涉及修改的数据页全部刷新到磁盘中。但是这么做会有性能瓶颈，主要体现在两个方面：</p>
<ul>
<li>因为 <code>Innodb</code> 是以 <code>页</code> 为单位进行磁盘交互的，而一个事务很可能只修改一个数据页里面的几个字节，这个时候将完整的数据页刷到磁盘的话，太浪费资源了！</li>
<li>一个事务可能涉及修改多个数据页，并且这些数据页在物理上并不连续，使用随机I/O写入性能太差！</li>
</ul>
<p>因此 <code>mysql</code> 设计了 <code>redo log</code> ， <strong>「redo log是物理日志，只记录事务对数据页做了哪些修改，而不是某一行或某几行修改成什么样，它用来恢复提交后的物理数据页(恢复数据页，且只能恢复到最后一次提交的位置)，相对而言文件更小并且是顺序IO」</strong>。</p>
<h3 id="2-3-redo-log效率为什么快"><a href="#2-3-redo-log效率为什么快" class="headerlink" title="2.3 redo log效率为什么快"></a>2.3 redo log效率为什么快</h3><p>Redo Log 默认是在事务提交的时候将日志写入磁盘，为什么它比直接将 Buffer Pool中修改的数据写入磁盘要快呢？</p>
<ul>
<li><strong>「磁盘刷脏操作是随机I/O，因为每次修改的数据的位置都是随机的，但是写redo log是追加操作，顺序I/O」</strong>。</li>
<li><strong>「磁盘刷脏是以数据页为单位的（Page），MySQL默认页的大小是16KB，一个page上一个小修改都要整页写入；而 redo log中只包含真正修改的部分，不会有无效I/O」</strong>。</li>
</ul>
<h3 id="2-4-redo-log基本概念"><a href="#2-4-redo-log基本概念" class="headerlink" title="2.4 redo log基本概念"></a>2.4 redo log基本概念</h3><ul>
<li><strong>「重做日志是一种基于磁盘的数据结构，用于在崩溃恢复期间修正不完整事务写入的数据」</strong>。</li>
<li>MySQL以循环方式写入重做日志文件，记录InnoDB中所有对Buffer Pool修改的日志。</li>
</ul>
<blockquote>
<p>当出现实例故障，导致数据未能更新到数据文件，则数据库重启时须redo，重新把数据更新到数据文件。读写事务在执行的过程中，都会不断的产生redo log。默认情况下，重做日志在磁盘上由两个名为ib_logfile0和ib_logfile1的文件物理表示。</p>
</blockquote>
<p><code>redo log</code> 包括两部分</p>
<ul>
<li>一个是内存中的日志缓冲( <code>redo log buffer</code> )，临时性</li>
<li>一个是磁盘上的日志文件( <code>redo log file</code>)，永久性。</li>
</ul>
<h3 id="2-5-redo-log写磁盘的方式"><a href="#2-5-redo-log写磁盘的方式" class="headerlink" title="2.5 redo log写磁盘的方式"></a>2.5 redo log写磁盘的方式</h3><p><code>mysql</code> 每执行一条 <code>DML</code> 语句，先将记录写入 <code>redo log buffer</code>，后续<strong>「某个时间点再一次性将多个操作记录写到 <code>redo log file</code>」</strong>。这种 <strong>「先写日志，再写磁盘」</strong> 的技术就是 <strong>「「预写式日志」」</strong>（<code>Write-Ahead Logging</code> ，缩写 WAL）。</p>
<p><strong>「在计算机操作系统中，用户空间( <code>user space</code> )下的缓冲区数据是无法直接写入磁盘的，中间必须经过操作系统内核空间( <code>kernel space</code> )的缓冲区( <code>OS Buffer</code> )」</strong>。因此， <code>redo log buffer</code> 写入 <code>redo log file</code> 实际上是<strong>「先写入 <code>OS Buffer</code> ，然后再通过系统调用 <code>fsync()</code> 将其刷到 <code>redo log file</code>中」</strong>。</p>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124947.png" alt="图片"></p>
<ul>
<li><p><strong>「redo log file刷盘时机」</strong></p>
<p><strong>「<code>mysql</code> 支持三种将 <code>redo log buffer</code> 写入 <code>redo log file</code> 的时机」</strong>，可以通过 <code>innodb_flush_log_at_trx_commit</code> 参数配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%innodb_flush_log_at_trx_commit%&#39;;</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| Variable_name                  | Value |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| innodb_flush_log_at_trx_commit | 1     |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">1 row in set, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure></li>
<li><ul>
<li><p>速度较快，比0安全，只有在<strong>「操作系统崩溃或者系统断电」</strong>的情况下，上一秒钟所有事务数据才可能丢失。</p>
</li>
<li><p>最安全，但也是最慢，即使mysql挂掉也不会丢失数据，但是IO频繁，性能下降。</p>
</li>
<li><p>速度最快，不太安全，在mysql挂掉的时候，会丢失一秒钟的数据。</p>
</li>
<li><p>当<code>innodb_flush_log_at_trx_commit</code> = 0</p>
<p>【<strong>「延迟写」</strong>】：<strong>「提交事务时不会立即将数据<code>redo log buffer</code> 写入到 <code>OS Buffer</code> ，而是通过 InnoDB 的主线程每秒写入 <code>OS Buffer</code>并调用 <code>fsync()</code> 将其刷到 <code>redo log file</code>中」</strong>。</p>
</li>
<li><p>当<code>innodb_flush_log_at_trx_commit</code> = 1</p>
<p>【<strong>「实时写实时刷」</strong>】：<strong>「每次提交事务时都会将数据<code>redo log buffer</code> 写入到 <code>OS Buffer</code> 并立即调用 <code>fsync()</code> 将其刷到 <code>redo log file</code>中」</strong>。</p>
</li>
<li><p>当<code>innodb_flush_log_at_trx_commit</code> = 2</p>
<p>【<strong>「实时写延迟刷」</strong>】：<strong>「每次提交事务时都会将数据<code>redo log buffer</code> 写入到 <code>OS Buffer</code> 中，然后每间隔一秒调用 <code>fsync()</code> 将其刷到 <code>redo log file</code>中」</strong></p>
</li>
</ul>
</li>
</ul>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<h3 id="2-6-redo-log写入形式"><a href="#2-6-redo-log写入形式" class="headerlink" title="2.6 redo log写入形式"></a>2.6 redo log写入形式</h3><p><strong>「在innodb中，既有<code>redo log</code> 需要刷盘，还有 <code>数据页</code> 也需要刷盘， <code>redo log</code>存在的意义主要就是降低对 <code>数据页</code> 刷盘的要求」</strong> 。</p>
<p><strong>「<code>redo log</code> 实际上记录数据页的变更，而这种变更记录是没必要全部保存，因此 <code>redo log</code>实现上采用了【大小固定，循环写入】的方式，当写到结尾时，会回到开头循环写日志」</strong>。如下图：</p>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124978.png" alt="图片"></p>
<ul>
<li><code>write pos</code> ：表示 <code>redo log</code> 当前记录的 <code>LSN</code> (逻辑序列号)位置</li>
<li><code>check point</code> ：表示 <strong>「数据页更改记录」</strong> 刷盘后对应 <code>redo log</code> 所处的 <code>LSN</code>(逻辑序列号)位置。</li>
</ul>
<p><code>write pos</code> 到 <code>check point</code> 之间的部分是 <code>redo log</code> 空着的部分，用于记录新的记录；</p>
<p><code>check point</code> 到 <code>write pos</code> 之间是 <code>redo log</code> 待落盘的数据页更改记录。</p>
<p>当 <code>write pos</code>追上<code>check point</code> 时，会先推动 <code>check point</code> 向前移动，空出位置再记录新的日志。</p>
<blockquote>
<p>启动 <code>innodb</code> 的时候，无论上次是正常关闭或异常关闭，都会进行恢复操作。</p>
<p>重启<code>innodb</code> 时，首先会检查磁盘中数据页的 <code>LSN</code> ，如果数据页的<code>LSN</code> 小于日志中的 <code>LSN</code> ，则会从 <code>checkpoint</code> 开始恢复。</p>
<p>如果在宕机前正处于<code>check point</code> 的刷盘过程，且<strong>「数据页的刷盘进度超过了日志页的刷盘进度」</strong>，此时会出现数据页中记录的 <code>LSN</code> 大于日志中的 <code>LSN</code>，这时超出日志进度的部分将不会重做，因为这本身就表示已经做过的事情，无需再重做。</p>
</blockquote>
<h3 id="2-7-Redo-Log和BinLog的比较"><a href="#2-7-Redo-Log和BinLog的比较" class="headerlink" title="2.7 Redo Log和BinLog的比较"></a>2.7 Redo Log和BinLog的比较</h3><p>redo log 主要用来。binlog是用来进行归档的。</p>
<p><strong>「一个更新的sql先执行到redo log内为预提交状态，binlog写入，写入之后通知redo log改提交状态」</strong></p>
<ul>
<li><p><strong>「作用不同」</strong></p>
</li>
<li><ul>
<li><p>redo log是用于【崩溃恢复】的，保证MySQL宕机也不会影响持久性。</p>
<blockquote>
<p>redo log 主要用来数据库宕机恢复数据的</p>
</blockquote>
</li>
<li><p>binlog是【用于时间点恢复】的，保证服务器可以基于时间点恢复数据或者用于主从复制。</p>
<blockquote>
<p>binlog是用来进行归档的</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>「层次不同」</strong></p>
</li>
<li><ul>
<li>redo log是InnoDB存储引擎实现的，innodb独享</li>
<li>binlog是MySQL的服务器层实现的服务，全局引擎共享</li>
</ul>
</li>
<li><p><strong>「内容不同」</strong></p>
</li>
<li><ul>
<li><p>redo log是物理日志，内容基于磁盘的数据Page，<strong>「记录该数据页更新状态内容」</strong></p>
<blockquote>
<p>比如：「将第6页、第8行、第7个位置改成aaaa」这种</p>
</blockquote>
</li>
<li><p>bin log是逻辑日志，内容是二进制的，根据binlog＿format参数的不同，分为不同的模式，可能基于SQL 语句、基于数据本身、或者二者的混合，<strong>「记录更新过程」</strong>。</p>
<blockquote>
<p>比如：insert into t values (null, 4, ‘2022-03-24’);  也跟bin log日志格式有关</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>「写入时机不同」</strong></p>
</li>
<li><ul>
<li>bin log是在事务提交完成后进行一次写入</li>
<li>redo log的写入时机有三种（具体在上文中有介绍）</li>
</ul>
</li>
<li><p><strong>「写入方式不同」</strong></p>
</li>
<li><ul>
<li>binlog在写满或者重启之后，会生成新的binlog文件，旧的日志数据会一直保留。</li>
<li>redo log是循环使用，会清理旧的日志数据。</li>
</ul>
</li>
</ul>
<h2 id="三-撤销日志（Undo-Logs）"><a href="#三-撤销日志（Undo-Logs）" class="headerlink" title="三 撤销日志（Undo Logs）"></a><strong>三 撤销日志（Undo Logs）</strong></h2><blockquote>
<p>世间没有后悔药，但是在MySQL中实现了重头开始，撤销日志（Undo Logs）就是MySQL的后悔药。</p>
</blockquote>
<p><strong>「撤消日志是在事务开始之前保存的被修改数据的备份，用于回滚事务」</strong>。</p>
<p>撤消日志属于逻辑日志，根据每行记录进行记录。</p>
<p>撤消日志存在于系统表空间、撤消表空间和临时表空间中。</p>
<h3 id="3-1-什么是Undo-log"><a href="#3-1-什么是Undo-log" class="headerlink" title="3.1 什么是Undo log"></a>3.1 什么是Undo log</h3><p>Undo：意为撤销或取消，undo即返回指定某个状态的操作</p>
<ul>
<li><p><strong>「undo log」</strong></p>
<p><strong>「一种用于撤销回退的日志，在事务开始之前，会先记录存放到 Undo 日志文件里，备份起来，当事务回滚时或者数据库崩溃时用于回滚事务」</strong>。</p>
</li>
<li><p><strong>「undo log记录的是什么」</strong></p>
<p><strong>「undo log中记录的是当前事务操作中的相反操作」</strong>。</p>
<p>undo日志属于逻辑日志，记录的是一个操作过程，sql执行delete或者update操作都会记录一条undo日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一条insert语句在undo log中会对应一条delete语句，</span><br><span class="line">一条delete语句在undo log中会对应一条insert语句，</span><br><span class="line">update语句会在undo log中对应相反的update语句，</span><br></pre></td></tr></table></figure>
<h3 id="3-2-Undo-log存储方式"><a href="#3-2-Undo-log存储方式" class="headerlink" title="3.2 Undo log存储方式"></a>3.2 Undo log存储方式</h3></li>
</ul>
<p><strong>「Undo log的存储由InnoDB存储引擎实现」</strong>，数据保存在InnoDB的数据文件中，innodb存储引擎对undo的管理采用回滚段（rollback segment）的数据结构。</p>
<p>回滚段（rollback segment）中有1024个undo log segment，</p>
<ul>
<li><p>MySQL5.5版本之前</p>
<p>只支持1个rollback segment，即只能存储1024个undo log segment</p>
</li>
<li><p>MySQL5.5版本之后</p>
<p>支持128个rollback segment（innodb_undo_logs配置项），即能存储128*1024个undo log segment</p>
</li>
</ul>
<h3 id="3-3-Undo-log相关的变量"><a href="#3-3-Undo-log相关的变量" class="headerlink" title="3.3 Undo log相关的变量"></a>3.3 Undo log相关的变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;%innodb_undo%&#39;;</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">| innodb_undo_directory    | .\    |</span><br><span class="line">| innodb_undo_log_truncate | OFF   |</span><br><span class="line">| innodb_undo_logs         | 128   |</span><br><span class="line">| innodb_undo_tablespaces  | 0     |</span><br><span class="line">+--------------------------+-------+</span><br><span class="line">4 rows in set, 1 warning (0.03 sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>innodb_undo_directory</p>
<p>定义存储的目录路径，默认值.\，表示datadir，</p>
<p>datadir参数在my.in中配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql数据库的数据的存放目录</span><br><span class="line">datadir&#x3D;&quot;D:\mysql-8.0.13-winx64\data&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>innodb_undo_log_truncate</p>
<p>开启1(ON)/关闭0(OFF)在线回收（收缩）undo log日志文件，支持动态设置，默认关闭</p>
</li>
<li><p>innodb_undo_logs</p>
<p>回滚段rollback segment的数量，Mysql5.5版本后默认设置为128</p>
</li>
<li><p>innodb_undo_tablespaces</p>
<p>默认值为0，表示undo log全部写入一个表空间文件，可以设置这个变量，平均分配到多少个文件中。</p>
</li>
</ul>
<h3 id="3-4-Undo-log的工作原理"><a href="#3-4-Undo-log的工作原理" class="headerlink" title="3.4 Undo log的工作原理"></a>3.4 Undo log的工作原理</h3><p><strong>「undo log在事务开启之前产生，当事务提交后，InnoDB会将事务对应的undo日志保存在删除list中，后台通过清除线程进行回收处理」</strong>。</p>
<p>以一条sql执行update、select过程，如图：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<ul>
<li>执行update操作，事务A提交时候（事务还没提交），会将数据进行备份，备份到对应的undo buffer，</li>
<li>Undo Log保存了未提交之前的操作日志，User表数据肯定就是持久保存到InnoDB的数据文件IBD，默认情况。</li>
<li>此时事务B进行查询操作，直接读undo buffer缓存，事务A还没提交事务，如需要回滚，不读磁盘，先直接从undo buffer缓存读取</li>
</ul>
<h3 id="3-5-Undo-log作用说明"><a href="#3-5-Undo-log作用说明" class="headerlink" title="3.5 Undo log作用说明"></a>3.5 Undo log作用说明</h3><ul>
<li><strong>「实现事务的原子性」</strong>undo log可以用于实现事务的原子性， 如果事务处理过程中要执行回滚（rollback）操作，可以利用undo log将数据恢复到事务开始之前</li>
<li><strong>「实现多版本并发控制（MVCC）」</strong>Undo Log 在 MySQL InnoDB 存储引擎中用来实现多版本并发控制，事务没提交之前，undo日志可以作为高并发情况下其它并发事务进行快照读。</li>
</ul>
<h3 id="3-6-Bin-log、redo-log、Undo-如何协同"><a href="#3-6-Bin-log、redo-log、Undo-如何协同" class="headerlink" title="3.6 Bin log、redo log、Undo 如何协同"></a>3.6 Bin log、redo log、Undo 如何协同</h3><p><strong>「先来回顾一下几个日志的主要作用」</strong></p>
<ul>
<li>Buffer Pool 是MySQL的一个非常重要的组件，因为针对数据库的增删改操作都是在Buffer Pool完成的</li>
<li>Undo log 记录的是数据操作前的样子</li>
<li>Redo log 记录的是数据被操作后的样子</li>
<li>Bin log 记录的是整个操作记录</li>
</ul>
<p><strong>「准备更新一条数据到事务的提交的流程描述：」</strong></p>
<ul>
<li><p>首先执行器根据MySQL的执行计划来查询数据，先是从缓存池(Buffer Pool)中查询数据，如果没有就会去 数据库中查询，如果查询到了就将其放到缓存池中。</p>
</li>
<li><p>在数据被缓存到缓存池的同时，会写入 undo log 日志文件</p>
</li>
<li><p>更新的动作是在BufferPool中完成的，同时会将更新后的数据添加到redo log buffer中</p>
</li>
<li><p>完成以后就可以提交事务，在提交的同时会做以下三件事</p>
</li>
<li><ul>
<li>将redo log buffer中的数据刷入到redo log 文件中</li>
<li>将本次操作记录写入到bin log文件中</li>
<li>将bin log 文件名字和更新内容在bin log中的位置记录到redo log中，同时在redo log 最后添加 commit 标记</li>
</ul>
</li>
</ul>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124896.png" alt="图片"></p>
<h3 id="3-7-Undo-log的清理"><a href="#3-7-Undo-log的清理" class="headerlink" title="3.7 Undo log的清理"></a>3.7 Undo log的清理</h3><h4 id="3-7-1-Undo-log类型"><a href="#3-7-1-Undo-log类型" class="headerlink" title="3.7.1 Undo log类型"></a>3.7.1 Undo log类型</h4><p><strong>「在回滚段中，每个 undo log 段都有一个类型字段，共有两种类型」</strong>：</p>
<ul>
<li><strong>「insert undo log」**</strong>「代表事务在<code>insert</code>新记录时产生的<code>undo log</code>, 其回滚段类型为 insert undo logs，仅用于事务回滚，并且在事务提交后可以被立即丢弃」**。</li>
<li><strong>「update undo log」**</strong>「事务在进行<code>update</code>或<code>delete</code>时产生的<code>undo log</code>，其回滚段类型为 update undo logs; 不仅在事务回滚时需要，在实现MVCC快照读时也需要」**</li>
</ul>
<h4 id="3-7-2-Undo-log清理类型"><a href="#3-7-2-Undo-log清理类型" class="headerlink" title="3.7.2 Undo log清理类型"></a>3.7.2 Undo log清理类型</h4><p>Undo log的清理也分为两种情况</p>
<ul>
<li><p><strong>「事务 rollback」</strong></p>
<p>如果事务rollback，innodb 通过执行 undo log中的所有反向操作，实现事务回滚，随后就会删除该事务关联的所有 undo log 段。</p>
</li>
<li><p><strong>「事务 commit」</strong></p>
</li>
<li><ul>
<li>对于 insert undo logs，事务回滚后，innodb会直接清除该事务关联的所有 undo log 段。</li>
<li>对于 update undo logs，只有当前没有任何活跃事务存在时，innodb 的 purge 线程才会清理这些 undo log 段</li>
</ul>
</li>
</ul>
<h4 id="3-7-3-purge-线程"><a href="#3-7-3-purge-线程" class="headerlink" title="3.7.3 purge 线程"></a>3.7.3 purge 线程</h4><p>上述提到的 <strong>「purge 线程，是一个周期运行的垃圾收集线程，主要用来收集 undo log 段」</strong>。</p>
<ul>
<li><p><strong>「innodb 会将所有需要清理的任务添加到 purge 队列中，」</strong></p>
<blockquote>
<p>可以通过 innodb_max_purge_lag 配置项设定 purge 队列的大小</p>
</blockquote>
</li>
<li><p><strong>「purge 线程会在周期执行时，对 purge 队列中的任务进行清理，」</strong></p>
<blockquote>
<p>可以通过innodb_max_purge_lag_delay 配置项设定 purge 线程的执行周期间隔</p>
</blockquote>
</li>
<li><p><strong>「尽量缩短使用中每个事务的持续时间，可以让 purge 线程有更大概率回收已经没有存在必要的 undo log 段，从而尽量释放磁盘空间的占用」</strong></p>
</li>
</ul>
<h2 id="四、错误日志-error-log"><a href="#四、错误日志-error-log" class="headerlink" title="四、错误日志(error log)"></a><strong>四、错误日志(error log)</strong></h2><p><strong>「错误日志(error log)：记录mysql服务的启停时正确和错误的信息，还记录启动、停止、运行过程中的错误信息。」</strong></p>
<ul>
<li><p><strong>「指定错误日志文件」</strong></p>
<p><strong>「在my.ini的[mysqld]下：添加代码：log-error=file_name.txt。」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log-error&#x3D;E:\log-error.txt。</span><br></pre></td></tr></table></figure>
<p><strong>「如果没有指定file_name，则默认的错误日志文件为datadir目录下的 <code>hostname</code>.err ，hostname表示当前的主机名。」</strong></p>
</li>
<li><p><strong>「查看错误日志位置」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;log_error&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124974.png" alt="图片"></p>
</li>
<li><p><strong>「错误日志的产生」</strong></p>
</li>
<li><ul>
<li><p><strong>「MySQL 5.5.7之前」</strong></p>
<p>刷新日志操作(如flush logs)会备份旧的错误日志(以_old结尾)，并创建一个新的错误日志文件并打开。</p>
</li>
<li><p><strong>「在MySQL 5.5.7之后」</strong></p>
<p>执行刷新日志的操作时，错误日志<strong>「会关闭并重新打开」</strong>，如果错误日志不存在，则会先创建。</p>
</li>
<li><p><strong>「MySQL正在运行状态下」</strong></p>
<p><strong>「在运行状态下删除错误日志后，不会自动创建错误日志，只有在刷新日志的时候才会创建一个新的错误日志文件」</strong>。</p>
</li>
</ul>
</li>
</ul>
<h2 id="五、查询日志"><a href="#五、查询日志" class="headerlink" title="五、查询日志"></a><strong>五、查询日志</strong></h2><p><strong>「查询日志分为一般查询日志和慢查询日志」</strong>。通过查询是否超出变量<strong>「long_query_time」</strong>指定时间的值来判定的。</p>
<p><strong>「在超时时间内完成的查询是一般查询，可以将其记录到一般查询日志中，超出时间的查询是慢查询，可以将其记录到慢查询日志中。」</strong></p>
<ul>
<li><p><strong>「long_query_time」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 指定慢查询超时时长，超出此时长的属于慢查询，会记录到慢查询日志中</span><br><span class="line">long_query_time &#x3D; 10 </span><br><span class="line"># 定义一般查询日志和慢查询日志的输出格式，不指定时默认为file</span><br><span class="line">log_output&#x3D;&#123;TABLE|FILE|NONE&#125;  </span><br></pre></td></tr></table></figure></li>
<li><ul>
<li><strong>「TABLE：表示记录日志到表中」</strong></li>
<li><strong>「FILE：表示记录日志到文件中」</strong></li>
<li><strong>「NONE：表示不记录日志」</strong></li>
</ul>
</li>
</ul>
<h3 id="5-1-一般查询日志-general-log"><a href="#5-1-一般查询日志-general-log" class="headerlink" title="5.1 一般查询日志(general log )"></a>5.1 一般查询日志(general log )</h3><p><strong>「记录了服务器接收到的每一个查询或是命令」</strong>，无论这些查询或是命令是否正确甚至是否包含语法错误，general log 都会将其记录下来 。</p>
<p>开启General logmysql服务器需要不断地记录日志，会产生一定的系统开销。 所有Mysql默认关闭一般查询日志。</p>
<ul>
<li><p><strong>「开启general log」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log&#x3D;on;#为全局变量</span><br></pre></td></tr></table></figure></li>
<li><p><strong>「开启general log」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log&#x3D;off;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>「查看general log是否开启」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#39;general_log&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124908.png" alt="图片"></p>
</li>
<li><p><strong>「设置日志文件路径」</strong></p>
<p>默认是库文件路径下主机名加上.log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file&#x3D;&#39;&#x2F;tmp&#x2F;general.log&#39;;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>「查看日志输出格式」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;log_output&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124055.png" alt="图片"></p>
</li>
</ul>
<h3 id="5-2-慢查询日志-slow-log"><a href="#5-2-慢查询日志-slow-log" class="headerlink" title="5.2 慢查询日志(slow log)"></a>5.2 慢查询日志(slow log)</h3><p><strong>「慢查询日志记录执行时间超过long_query_time和没有使用索引的查询语句，并且只会记录执行成功的语句。」</strong></p>
<p><strong>「查询超出变量 long_query_time 指定时间值的为慢查询。不包含查询获取锁(包括锁等待)的时间」</strong>。</p>
<ul>
<li><p><strong>「查看慢查询指定时间」</strong></p>
<p><strong>「默认10s」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like  &#39;long_query_time&#39;;</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+-----------------+-----------+</span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></li>
<li><p><strong>「查看慢查询的条数」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show status like &quot;%slow_queries%&quot;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Slow_queries  | 4     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>以上Slow_queries = 4 说明查询超过10秒的查询有4个</p>
</blockquote>
</li>
<li><p><strong>「启用慢查询日志」</strong></p>
<p>1与ON等价，0与OFF等价。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set @@global.slow_query_log&#x3D;on;</span><br><span class="line">#或者  </span><br><span class="line">mysql&gt; set @@global.slow_query_log&#x3D;1;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>「查看是否启用慢查询日志」</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;slow_query%&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124161.png" alt="图片"></p>
</li>
<li><p><strong>「slow_query_log」</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slow_query_log&#x3D;&#123;1|ON|0|OFF&#125; 与  log_slow_queries&#x3D;&#123;&#96;&#96;yes&#96;&#96;|no&#125; 都是表示是否启用慢查询日志，两个同时变化。</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>「slow_query_log_file」</strong></p>
<p>日志文件位置，默认路径为库文件目录下主机名加上-slow.log</p>
</li>
</ul>
<p><strong>「【MySQL记录慢查询日志是在查询执行完毕且已经完全释放锁之后记录的】，因此慢查询日志记录的顺序和执行的SQL查询语句顺序可能会不一致（先执行完先记录）」</strong>。</p>
<h2 id="六、中继日志-relay-log"><a href="#六、中继日志-relay-log" class="headerlink" title="六、中继日志(relay log)"></a><strong>六、中继日志(relay log)</strong></h2><p><strong>「主要作用：主从复制」</strong></p>
<p><strong>「【从服务器I/O线程】将主服务器的【二进制日志】读取过来记录到从服务器本地文件，然后【从服务器SQL线程】会读取relay-log日志的内容并应用到从服务器，从而使从服务器和主服务器的数据保持一致」</strong></p>
<ul>
<li><strong>「查看relay log配置」</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%relay%&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://images-roland.oss-cn-shenzhen.aliyuncs.com/blog/mysql/202208061124222.png" alt="图片"></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>MySQL(七)：一文详解六大日志</p><p><a href="http://ityouknow.cn/2021/08/06/MySQL%E4%B8%83%EF%BC%9A%E4%B8%80%E6%96%87%E8%AF%A6%E8%A7%A3%E5%85%AD%E5%A4%A7%E6%97%A5%E5%BF%97/">http://ityouknow.cn/2021/08/06/MySQL%E4%B8%83%EF%BC%9A%E4%B8%80%E6%96%87%E8%AF%A6%E8%A7%A3%E5%85%AD%E5%A4%A7%E6%97%A5%E5%BF%97/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>yunlongn</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-08-06</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-08-06</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Mysql/">Mysql</a></div><div class="bdsharebuttonbox"><a class="bds_more" href="#" data-cmd="more"></a><a class="bds_qzone" href="#" data-cmd="qzone" title="分享到QQ空间"></a><a class="bds_tsina" href="#" data-cmd="tsina" title="分享到新浪微博"></a><a class="bds_tqq" href="#" data-cmd="tqq" title="分享到腾讯微博"></a><a class="bds_renren" href="#" data-cmd="renren" title="分享到人人网"></a><a class="bds_weixin" href="#" data-cmd="weixin" title="分享到微信"></a></div><script>window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": "", "bdMini": "2", "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {} }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];</script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/08/06/MySQL%E5%85%AB%EF%BC%9A%E8%AF%BB%E6%87%82MVCC%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">MySQL(八)：读懂MVCC多版本并发控制</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/08/06/MySQL%E5%85%AD%EF%BC%9AInnoDB%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6/"><span class="level-item">MySQL六：InnoDB数据文件</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "5e83e3c952eda75b244628b43ef806f5",
            repo: "yunlongn.github.io",
            owner: "yunlongn",
            clientID: "fb8ffef00dff08ccb06c",
            clientSecret: "935a05558f847f4321d3c64b4c0c2498697a2bda",
            admin: "yunlongn",
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="云扬四海"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">云扬四海</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">77</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">24</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="http://github.com/yunlongn" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="http://github.com/yunlongn"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="cnblogs" href="https://www.cnblogs.com/rolandlee/"><i class="fas fa-book"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="tagscloud" style="transition: opacity 0.3s ease-out 0s, transform 0.3s ease-out 0s; opacity: 1; transform-origin: center top;"><div class="card-content" id="tags"><h3 class="menu-label">标签云</h3><a href="/tags/JVM/" style="color:rgb(139,149,95);font-size:13px">JVM<span class="tag-cloud-count">(1) </span></a><a href="/tags/Java/" style="color:rgb(158,165,80);font-size:15px">Java<span class="tag-cloud-count">(5) </span></a><a href="/tags/Mysql/" style="color:rgb(175,139,103);font-size:22px">Mysql<span class="tag-cloud-count">(18) </span></a><a href="/tags/Netty/" style="color:rgb(158,150,95);font-size:13px">Netty<span class="tag-cloud-count">(1) </span></a><a href="/tags/Nginx/" style="color:rgb(134,118,151);font-size:14px">Nginx<span class="tag-cloud-count">(1) </span></a><a href="/tags/SpringBoot/" style="color:rgb(136,115,138);font-size:14px">SpringBoot<span class="tag-cloud-count">(2) </span></a><a href="/tags/heroku/" style="color:rgb(145,110,129);font-size:17px">heroku<span class="tag-cloud-count">(1) </span></a><a href="/tags/java/" style="color:rgb(168,174,103);font-size:21px">java<span class="tag-cloud-count">(1) </span></a><a href="/tags/java%E5%9F%BA%E7%A1%80/" style="color:rgb(142,154,130);font-size:20px">java基础<span class="tag-cloud-count">(2) </span></a><a href="/tags/java%E6%A0%B8%E5%BF%83/" style="color:rgb(147,123,125);font-size:17px">java核心<span class="tag-cloud-count">(1) </span></a><a href="/tags/linux/" style="color:rgb(177,170,144);font-size:14px">linux<span class="tag-cloud-count">(1) </span></a><a href="/tags/mq/" style="color:rgb(161,174,139);font-size:17px">mq<span class="tag-cloud-count">(1) </span></a><a href="/tags/mybatisPlus/" style="color:rgb(202,131,132);font-size:13px">mybatisPlus<span class="tag-cloud-count">(1) </span></a><a href="/tags/nio/" style="color:rgb(183,136,90);font-size:13px">nio<span class="tag-cloud-count">(1) </span></a><a href="/tags/servlet/" style="color:rgb(169,138,131);font-size:16px">servlet<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E4%BA%8B%E5%8A%A1/" style="color:rgb(191,164,146);font-size:21px">事务<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E4%BF%A1%E5%8F%B7%E9%87%8F/" style="color:rgb(191,162,106);font-size:14px">信号量<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" style="color:rgb(131,126,144);font-size:21px">分布式事务<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E5%9B%BE%E7%89%87%E8%AF%86%E5%88%AB/" style="color:rgb(188,133,114);font-size:20px">图片识别<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" style="color:rgb(153,105,90);font-size:13px">基本命令<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="color:rgb(194,162,110);font-size:17px">小程序<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="color:rgb(193,151,128);font-size:18px">工具<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E6%80%A7%E8%83%BD/" style="color:rgb(170,173,142);font-size:13px">性能<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E6%8A%80%E5%B7%A7/" style="color:rgb(135,105,81);font-size:13px">技巧<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E7%AD%BE%E5%90%8D/" style="color:rgb(193,173,102);font-size:18px">签名<span class="tag-cloud-count">(2) </span></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="color:rgb(185,142,96);font-size:15px">设计模式<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" style="color:rgb(139,111,142);font-size:15px">读书笔记<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E9%98%B2%E7%9B%97%E9%93%BE/" style="color:rgb(130,170,132);font-size:19px">防盗链<span class="tag-cloud-count">(1) </span></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="color:rgb(178,157,118);font-size:14px">面试<span class="tag-cloud-count">(1) </span></a></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="http://www.ityouknow.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">纯洁的微笑</span></span><span class="level-right"><span class="level-item tag">www.ityouknow.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.52itstyle.vip/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">柒&#039;s</span></span><span class="level-right"><span class="level-item tag">blog.52itstyle.vip</span></span></a></li><li><a class="level is-mobile" href="https://www.wdk.pw/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">王登科</span></span><span class="level-right"><span class="level-item tag">www.wdk.pw</span></span></a></li></ul></div></div></div></div><!--!--></div></div></section><embed src="/img/footer.svg" id="galinv" type="image/svg+xml"><footer class="footer"><div class="footer-image"><img src="/img/o_cnblogs_footer.png" width="60%"></div><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">云扬四海</a><p class="is-size-7"><span>&copy; 2022 yunlongn</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/yunlongn"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>